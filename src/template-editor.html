<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="template-editor.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Joystick Template Editor - Star Citizen Joystick Mapper</title>
    <script type="module" src="/template-editor.js" defer></script>
</head>

<body>
    <div class="app-container">
        <!-- Main App Header (Persistent) -->
        <header class="app-header">
            <div class="header-left">
                <h1>Star Citizen Joystick Mapper</h1>
                <div id="loaded-file-indicator" class="loaded-file-indicator" style="display: none;">
                    <span class="file-icon">üìÑ</span>
                    <span id="loaded-file-name">No file loaded</span>
                </div>
            </div>
            <div class="header-actions">
                <button id="back-btn" class="btn btn-secondary">‚Üê Main</button>
                <button id="input-debugger-btn" class="btn btn-secondary">üîç Input Debugger</button>
                <button id="visual-view-btn" class="btn btn-secondary">Visual View</button>
                <button id="template-editor-btn" class="btn btn-secondary active-page">Template Editor</button>
            </div>
        </header>

        <!-- Page Sub-Header -->
        <div class="tab-subheader">
            <h2>Template Editor</h2>
            <div class="subheader-actions">
                <div class="stick-selector">
                    <button id="left-stick-btn" class="btn btn-secondary">Left Stick</button>
                    <button id="right-stick-btn" class="btn btn-secondary active">Right Stick</button>
                </div>
                <button id="new-template-btn" class="btn btn-secondary">+ New Template</button>
                <button id="save-template-btn" class="btn btn-primary">Save Template</button>
                <button id="load-template-btn" class="btn btn-secondary">Load Template</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content editor-content">
            <!-- Left Sidebar - Controls -->
            <aside class="editor-sidebar">
                <div class="section">
                    <h3>Template Info</h3>
                    <label>
                        Template Name:
                        <input type="text" id="template-name" placeholder="e.g., T16000M Left" />
                    </label>
                    <label>
                        Joystick Model:
                        <input type="text" id="joystick-model" placeholder="e.g., Thrustmaster T16000M" />
                    </label>
                    <button id="configure-template-joysticks-btn" class="btn btn-secondary btn-block">‚öôÔ∏è Configure
                        Joystick Mapping</button>
                    <div id="stick-mapping-display" class="info-text" style="margin-top: 0.5rem;">
                        <div><strong>Left Stick:</strong> <span id="left-stick-mapping">Not configured</span></div>
                        <div><strong>Right Stick:</strong> <span id="right-stick-mapping">Not configured</span></div>
                    </div>
                </div>

                <div class="section">
                    <h3>Image</h3>
                    <label>
                        Image Mode:
                        <select id="image-type-select">
                            <option value="single">Single Image (Both Sticks)</option>
                            <option value="dual">Separate Images (Left & Right)</option>
                        </select>
                    </label>
                    <button id="load-image-btn" class="btn btn-secondary btn-block">Load Joystick Image</button>
                    <div id="image-info" class="info-text"></div>
                </div>

                <div class="section">
                    <h3>Image Mirror</h3>
                    <label>
                        Mirror Settings:
                        <select id="image-flip-select">
                            <option value="none">No Mirror</option>
                            <option value="left">Mirror Left Stick</option>
                            <option value="right">Mirror Right Stick</option>
                        </select>
                    </label>
                    <div class="info-text">
                        If you have one image, select which stick to mirror. Select "No Mirror" if you have two
                        different images.
                    </div>
                </div>

                <div class="section">
                    <div class="button-list" id="button-list">
                        <div class="empty-state-small">No buttons added yet</div>
                    </div>
                    <button id="add-button-btn" class="btn btn-secondary btn-block">+ Add Button</button>
                </div>

                <div class="section">
                    <h3>Instructions</h3>
                    <div class="instructions">
                        <p><strong>Adding a button:</strong></p>
                        <ol>
                            <li>Click "Add Button"</li>
                            <li>Click on the joystick image where the button is</li>
                            <li>Click where you want the label box to appear</li>
                            <li>Enter the button name/number</li>
                        </ol>
                        <p><strong>Editing:</strong></p>
                        <ul>
                            <li>Click a button in the list to select it</li>
                            <li>Double-click a button to edit its name/ID</li>
                            <li>Click "Delete Selected" to remove</li>
                            <li>Drag the handles on the canvas to reposition</li>
                        </ul>
                    </div>
                </div>

                <div class="section">
                    <button id="delete-button-btn" class="btn btn-danger btn-block" disabled>Delete Selected</button>
                    <button id="clear-all-btn" class="btn btn-danger btn-block">Clear All Buttons</button>
                    <button id="mirror-template-btn" class="btn btn-secondary btn-block">üîÑ Mirror Template</button>
                    <button id="change-joystick-number-btn" class="btn btn-secondary btn-block">üî¢ Change All JS
                        Numbers</button>
                </div>
            </aside>
        </div>
    </div>

    <!-- Button Details Modal -->
    <div id="button-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Button Details</h2>
            <label>
                Button Name:
                <input type="text" id="button-name-input" placeholder="e.g., Trigger or Hat 1" />
            </label>
            <label>
                Button Type:
                <select id="button-type-select">
                    <option value="simple">Simple Button/Axis</option>
                    <option value="hat4way">4-Way Hat Switch</option>
                </select>
            </label>

            <!-- Simple button input detection -->
            <div id="simple-input-section" style="margin-top: 1rem;">
                <div
                    style="padding: 0.75rem; background: var(--bg-secondary); border-radius: 4px; margin-bottom: 0.5rem;">
                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Button ID:
                    </div>
                    <div id="button-id-display"
                        style="font-size: 1.1rem; font-weight: 500; color: var(--text-primary);">‚Äî</div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">Full ID:
                    </div>
                    <code id="button-full-id-display"
                        style="font-size: 0.9rem; color: #4ec9b0; background: var(--bg-dark); padding: 0.3rem 0.5rem; border-radius: 3px; display: inline-block;">‚Äî</code>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                    <button id="button-modal-detect" class="btn btn-secondary">üéÆ Detect Input</button>
                    <button id="button-modal-clear" class="btn btn-secondary">‚úï Clear</button>
                </div>
                <div id="input-detection-status" class="info-text"
                    style="display: none; margin-top: 0.5rem; text-align: center;"></div>
            </div>

            <!-- Hat switch input detection -->
            <div id="hat-input-section" style="display: none; margin-top: 1rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
                    <div style="padding: 0.5rem; background: var(--bg-secondary); border-radius: 4px;">
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">‚Üë Up ID:
                        </div>
                        <div class="hat-id-display" data-direction="up" style="font-size: 0.95rem; font-weight: 500;">‚Äî
                        </div>
                    </div>
                    <div style="padding: 0.5rem; background: var(--bg-secondary); border-radius: 4px;">
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">‚Üì Down
                            ID:</div>
                        <div class="hat-id-display" data-direction="down" style="font-size: 0.95rem; font-weight: 500;">
                            ‚Äî</div>
                    </div>
                    <div style="padding: 0.5rem; background: var(--bg-secondary); border-radius: 4px;">
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">‚Üê Left
                            ID:</div>
                        <div class="hat-id-display" data-direction="left" style="font-size: 0.95rem; font-weight: 500;">
                            ‚Äî</div>
                    </div>
                    <div style="padding: 0.5rem; background: var(--bg-secondary); border-radius: 4px;">
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">‚Üí Right
                            ID:</div>
                        <div class="hat-id-display" data-direction="right"
                            style="font-size: 0.95rem; font-weight: 500;">‚Äî</div>
                    </div>
                </div>
                <div style="padding: 0.5rem; background: var(--bg-secondary); border-radius: 4px; margin-bottom: 1rem;">
                    <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">‚¨áÔ∏è Push ID:
                    </div>
                    <div class="hat-id-display" data-direction="push" style="font-size: 0.95rem; font-weight: 500;">‚Äî
                    </div>
                </div>
                <p style="font-size: 0.9rem; color: var(--text-secondary); margin: 0.5rem 0 0.5rem 0;">Or detect
                    automatically:</p>
                <div style="display: grid; gap: 0.5rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="up">‚¨ÜÔ∏è Detect
                            Up</button>
                        <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="up">‚úï Clear Up</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="down">‚¨áÔ∏è Detect
                            Down</button>
                        <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="down">‚úï Clear
                            Down</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="left">‚¨ÖÔ∏è Detect
                            Left</button>
                        <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="left">‚úï Clear
                            Left</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="right">‚û°Ô∏è Detect
                            Right</button>
                        <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="right">‚úï Clear
                            Right</button>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="push">‚¨áÔ∏è Detect
                            Push</button>
                        <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="push">‚úï Clear
                            Push</button>
                    </div>
                </div>
                <div id="hat-detection-status" class="info-text"
                    style="display: none; margin-top: 0.5rem; text-align: center;"></div>
            </div>

            <div class="modal-buttons" style="margin-top: 1.5rem;">
                <button id="button-modal-delete" class="btn btn-danger">Delete Button</button>
                <button id="button-modal-cancel" class="btn btn-secondary">Cancel</button>
                <button id="button-modal-save" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Template Joystick Mapping Modal -->
    <div id="template-joystick-mapping-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Joystick Mapping for Template</h2>
                <button class="modal-close" id="template-joystick-mapping-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="mapping-help">Map your physical joysticks to the left stick (js1) and right stick (js2) for
                    this template. Press any button on a joystick to identify it.</p>
                <div id="template-joystick-mapping-list" class="joystick-mapping-list">
                    <!-- Joystick mappings will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="template-joystick-mapping-detect" class="btn btn-primary">üîÑ Detect Joysticks</button>
                <button id="template-joystick-mapping-save" class="btn btn-primary">Save Mapping</button>
                <button id="template-joystick-mapping-cancel" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="image-file-input" accept="image/*" style="display: none;" />
    <input type="file" id="template-file-input" accept=".json" style="display: none;" />
</body>

</html>